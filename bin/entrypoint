#!/usr/with-contenv bash
# shellcheck shell=bash
echo "Entering entrypoint."
set -e

/opt/mastodon/bin/start-sshd;

/opt/mastodon/bin/show-branding;

if [[ $PROGRAM == "mastodon" ]]; then
    /opt/mastodon/bin/show-mastodon-branding;
    /opt/mastodon/bin/start-mastodon;
elif [[ $PROGRAM == "sidekiq" ]]; then
    /opt/mastodon/bin/show-sidekiq-branding;
    /opt/mastodon/bin/start-sidekiq;
elif [[ $PROGRAM == "streaming" ]]; then
    /opt/mastodon/bin/show-streaming-branding;
    /opt/mastodon/bin/start-streaming;
elif [[ $PROGRAM == "all" ]]; then
    /opt/mastodon/bin/show-mastodon-branding;
    /opt/mastodon/bin/start-mastodon;
    /opt/mastodon/bin/show-sidekiq-branding;
    /opt/mastodon/bin/start-sidekiq;
    /opt/mastodon/bin/show-mastodon-branding;
    /opt/mastodon/bin/start-streaming;
else
    echo "Program '${PROGRAM}' was not found and could not be started.";
    exit 1;
fi

/opt/mastodon/bin/start-nginx;

/opt/mastodon/bin/sleep-forever;

echo "Exiting entrypoint."
