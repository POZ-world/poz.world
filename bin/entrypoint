#!/usr/bin/with-contenv bash
# shellcheck shell=bash

set -e
export RAILS_ENV=production
export PATH="/opt/mastodon/bin:/bin:/usr/bin:/usr/sbin:/usr/local/bin:${PATH}"
export PROGRAM="$1"

if [[ $PROGRAM == "mastodon" ]]; then
    /bin/bash start-mastodon 
elif [[ $PROGRAM == "sidekiq" ]]; then
    /bin/bash start-sidekiq 
elif [[ $PROGRAM == "streaming" ]]; then
    /bin/bash start-streaming 
elif [[ $PROGRAM == "all" ]]; then
    /bin/bash start-mastodon 
    /bin/bash start-sidekiq 
    /bin/bash start-streaming 
else
    /bin/echo "Program '${PROGRAM}' was not found and could not be started.";
fi