#!/bin/bash

# Check if a file path is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <file_path>"
    exit 1
fi

# Assign input to variable
FILE_PATH=$1

# Define a regular expression to match ${ENVIRONMENT_VARIABLE}
regex='\${([A-Z_][A-Z0-9_]*)}'

# Create a backup of the original file
cp "$FILE_PATH" "$FILE_PATH.bak"

# Loop through each line in the file
while read -r line; do
    # While there is a match for the regex in the line
    while [[ $line =~ $regex ]]; do
        # Extract the matched environment variable name
        ENV_VAR_NAME="${BASH_REMATCH[1]}"
        # Replace the matched ${ENVIRONMENT_VARIABLE} with the actual value of the environment variable
        line=${line//\$\{$ENV_VAR_NAME\}/${!ENV_VAR_NAME}}
    done
    # Print the modified line
    echo "$line"
done < "$FILE_PATH" > "${FILE_PATH}.tmp"

# Replace the original file with the modified file
mv "${FILE_PATH}.tmp" "$FILE_PATH"

echo "Replacements completed. Backup of the original file saved as ${FILE_PATH}.bak"